# 카페24 위젯 연동 가이드

## 개요

스태프 리뷰 위젯을 카페24 쇼핑몰 상품 상세 페이지에 삽입하는 방법입니다.
위젯은 외부 서버(Railway)에서 리뷰 데이터를 불러와 표시합니다.

## 전제 조건

- ✅ FastAPI 서버가 Railway에 배포되어 HTTPS URL이 있는 상태
- ✅ 카페24 쇼핑몰 관리자 접근 권한
- ✅ 카페24 스마트디자인 사용 중

## Step 1: 서버 URL 확인

Railway 배포 후 생성된 URL을 확인합니다:
```
https://your-app.up.railway.app
```

이 URL의 `/api/stats`에 접속하여 정상 동작을 확인합니다.

## Step 2: 카페24 스마트디자인 편집

### 2-1. 카페24 관리자 접속
카페24 쇼핑몰 관리자 → **디자인관리** → **디자인 수정하기**

### 2-2. 상품 상세 페이지 HTML 찾기
스마트디자인 편집창에서:
- 왼쪽 메뉴: **상품** → **상품 상세**
- 또는 직접 파일 검색: `product/detail.html`

### 2-3. 위젯 코드 삽입

상품 설명 아래, 또는 기존 리뷰 섹션 근처에 아래 코드를 삽입:

```html
<!-- ===== 스태프 리뷰 위젯 시작 ===== -->
<div id="staff-review-widget" data-product-id="{$product_no}"></div>
<link rel="stylesheet" href="https://your-app.up.railway.app/static/widget.css">
<script src="https://your-app.up.railway.app/static/widget.js"
        data-server="https://your-app.up.railway.app"></script>
<!-- ===== 스태프 리뷰 위젯 끝 ===== -->
```

> **중요**: `{$product_no}`는 카페24의 치환코드입니다.
> 실제 상품 페이지에서 자동으로 해당 상품 번호로 변환됩니다.
> 이 코드를 그대로 붙여넣으세요 (숫자로 바꾸지 마세요).

### 2-4. 저장 및 확인

1. 저장 버튼 클릭
2. 쇼핑몰 프론트에서 상품 상세 페이지 접속
3. 해당 상품에 스태프 리뷰가 등록되어 있으면 위젯 노출 확인
4. 리뷰가 없으면 위젯은 빈 상태로 아무것도 표시하지 않음

## Step 3: 리뷰 등록

### 3-1. 관리자 페이지 접속
```
https://your-app.up.railway.app/admin
```

### 3-2. 리뷰 작성
- **상품 ID**: 카페24 상품번호 입력 (예: 27)
  - 카페24 관리자 → 상품관리에서 상품번호 확인 가능
- **상품명**: 선택 (관리 편의용)
- **작성자**: 스태프 이름 또는 닉네임
- **별점**: 1~5점
- **리뷰 내용**: 상품 리뷰 텍스트
- **이미지**: 선택 첨부

### 3-3. 노출 확인
리뷰의 상태가 "노출"이면 위젯에 표시됩니다.

## 대안: 전역 스크립트 삽입 방법

상품 상세 페이지 HTML을 직접 수정하기 어려운 경우:

### 방법 A: SEO 고급설정
카페24 관리자 → **상점관리** → **운영관리** → **검색엔진최적화(SEO)** → **고급설정**

- Head 태그 소스에 `<link>` 삽입
- Body 태그 소스에 `<script>` 삽입

### 방법 B: 외부 스크립트 관리
카페24 관리자 → **디자인관리** → **쇼핑몰 환경설정** → **외부스크립트**

HTML 태그가 끝나는 푸터 부분에 위젯 스크립트를 삽입합니다.

> 단, 이 방법들은 모든 페이지에 스크립트가 로드되므로
> 위젯 JS가 상품 상세 페이지에서만 동작하도록 내부 처리가 필요합니다.
> (widget.js는 이미 `staff-review-widget` div가 없으면 아무것도 하지 않으므로 안전합니다)

## 트러블슈팅

### 위젯이 안 보여요
1. 브라우저 개발자도구 → 콘솔 탭에서 에러 확인
2. CORS 에러가 있으면: 서버의 `ALLOWED_ORIGINS` 환경변수에 카페24 도메인 추가
3. Mixed Content 에러: 서버가 반드시 HTTPS여야 함

### 상품번호가 안 맞아요
1. 카페24 관리자 → 상품관리에서 정확한 상품번호 확인
2. 위젯의 `data-product-id`가 `{$product_no}` 치환코드인지 확인
3. 관리자에서 리뷰의 상품 ID가 카페24 상품번호와 일치하는지 확인

### 모바일에서 깨져요
- widget.css에 반응형 스타일이 포함되어 있음
- 카페24 모바일 스킨에서도 위젯 코드가 삽입되어 있는지 확인
- PC와 모바일 스킨이 다르면 양쪽 모두에 코드 삽입 필요

### 기존 리뷰 앱과 충돌해요
- 위젯 CSS는 `srw-` 접두사를 사용하므로 일반적으로 충돌 없음
- 알파리뷰 등 기존 앱과 함께 사용 가능
- `#staff-review-widget` ID가 다른 요소와 겹치지 않는지 확인
